[Unit]
Description=WebODM - worker
After=docker.service redis.service webodm-web.service
Requires=docker.service redis.service webodm-web.service

[Service]
Restart=always
ExecStartPre=-/usr/bin/docker kill %n
ExecStartPre=-/usr/bin/docker rm %n
ExecStart=/bin/bash -c "docker run \
    --init \
    --rm \
    -e WO_BROKER=redis://redis \
    -e WO_PGHOST=$(hostname -I | awk '{print $1}') \
    --link redis \
    --link nodeodm.service \
    --name %n \
    --tmpfs /tmp \
    -v /opt/data/webodm:/webodm/app/media \
    -v /etc/webodm.py:/webodm/webodm/local_settings.py \
    opendronemap/webodm_webapp@sha256:e8f4029a88d39c692a428a606d6432ea44bedab6473a262faff331ad8286fa22 \
    /webodm/worker.sh start"

[Install]
WantedBy=multi-user.target
